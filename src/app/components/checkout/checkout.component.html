<form [formGroup]="checkoutFormGroup" (ngSubmit) = "onSubmit()">
    <mat-vertical-stepper formArrayName="formArray" [linear]="false" #stepper>
        <mat-step formGroupName="0" [stepControl]="formArray?.get([0])!">
            <ng-template matStepLabel>Fill out your name</ng-template>
            <div class="form-area">
                <mat-form-field>
                    <mat-label>First Name</mat-label>
                    <input matInput formControlName="firstName">
                    <mat-error *ngIf="(firstName?.invalid && (firstName?.dirty || firstName?.touched)) 
                        && firstName?.errors?.['required'] || firstName?.errors?.['notOnlyWhitespace']">
                        First name is required.
                    </mat-error>
                    <mat-error *ngIf="(firstName?.invalid && (firstName?.dirty || firstName?.touched)) && 
                        firstName?.errors?.['minlength']">
                        First Name must be at least 2 characters long.
                    </mat-error>
                </mat-form-field>
                <mat-form-field>
                    <mat-label>Last Name</mat-label>
                    <input matInput formControlName="lastName">
                    <mat-error *ngIf="(lastName?.invalid && (lastName?.dirty || lastName?.touched)) 
                        && lastName?.errors?.['required'] || lastName?.errors?.['notOnlyWhitespace']">
                        Last name is required.
                    </mat-error>
                    <mat-error *ngIf="(lastName?.invalid && (lastName?.dirty || lastName?.touched)) && 
                        lastName?.errors?.['minlength']">
                        Last Name must be at least 2 characters long.
                    </mat-error>
                </mat-form-field>
                <mat-form-field>
                    <mat-label>Email</mat-label>
                    <input matInput formControlName="email">
                    <mat-error *ngIf="(email?.invalid && (email?.dirty || email?.touched)) 
                        && email?.errors?.['required']">
                        Email is required.
                    </mat-error>
                    <mat-error *ngIf="(email?.invalid && (email?.dirty || email?.touched)) && 
                        email?.errors?.['pattern']">
                        Email must be a valid email address format.
                    </mat-error>
                </mat-form-field>
            </div>
            <div>
                <button mat-button matStepperNext class="next-button" type="button">Next</button>
            </div>
        </mat-step>
        <mat-step formGroupName="1" [stepControl]="formArray?.get([1])!">
            <ng-template matStepLabel>Shipping Information</ng-template>
            <div class="form-area" id="shipping-address">
                <!-- <mat-form-field>
                    <mat-label>Country</mat-label>
                    <mat-select formControlName = "country"
                    (selectionChange)="getStates(1)">
                        <mat-option *ngFor = "let tempCountry of countries"
                        
                        [value] = "tempCountry">{{tempCountry.name}}</mat-option>
                    </mat-select>
                    <mat-error *ngIf="(shippingAddressCountry?.invalid && (shippingAddressCountry?.dirty 
                        || shippingAddressCountry?.touched)) 
                            && shippingAddressCountry?.errors?.['required']">
                            Country is required.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>Street</mat-label>
                        <input matInput formControlName="street">
                        <mat-error *ngIf="(shippingAddressStreet?.invalid && (shippingAddressStreet?.dirty 
                        || shippingAddressStreet?.touched)) 
                            && shippingAddressStreet?.errors?.['required']">
                            Street is required.
                        </mat-error>
                        <mat-error *ngIf="(shippingAddressStreet?.invalid && (shippingAddressStreet?.dirty 
                        || shippingAddressStreet?.touched)) 
                            && shippingAddressStreet?.errors?.['minlength']">
                            Street must be at least 2 characters long.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>City</mat-label>
                        <input matInput formControlName="city">
                        <mat-error *ngIf="(shippingAddressCity?.invalid && (shippingAddressCity?.dirty || shippingAddressCity?.touched)) 
                            && shippingAddressCity?.errors?.['required']">
                            City is required.
                        </mat-error>
                        <mat-error *ngIf="(shippingAddressCity?.invalid && (shippingAddressCity?.dirty || shippingAddressCity?.touched)) 
                            && shippingAddressCity?.errors?.['minlength']">
                            City is required.
                        </mat-error>
                    </mat-form-field>
                    
                <mat-form-field>
                    <mat-label>State</mat-label>
                    <mat-select formControlName = "state">
                        <mat-option *ngFor = "let tempState of shippingAddressStates"
                        [value] = "tempState">{{tempState.name}}</mat-option>
                    </mat-select>
                    <mat-error *ngIf="(shippingAddressState?.invalid && (shippingAddressState?.dirty || shippingAddressState?.touched)) 
                        && shippingAddressState?.errors?.['required']">
                        State is required.
                    </mat-error>
                </mat-form-field>
                <mat-form-field>
                    <mat-label>Zipcode</mat-label>
                    <input matInput formControlName = "zipcode">
                    <mat-error *ngIf="(shippingAddressZipcode?.invalid && (shippingAddressZipcode?.dirty || shippingAddressZipcode?.touched)) 
                        && shippingAddressZipcode?.errors?.['required']">
                        Zipcode is required.
                    </mat-error>
                </mat-form-field> -->
            </div>
            <div>
                <button mat-button matStepperPrevious type="button">Back</button>
                <button mat-button matStepperNext type="button" (click) = "showAddress()">Next</button>
              </div>
        </mat-step>
        <!-- credit card/payment -->
        <mat-step formGroupName="2" [stepControl] = "formArray?.get([2])!">
            <ng-template matStepLabel>Payment Information</ng-template>
            <div class="form-area">
                <!-- <div id="shipping-address"></div> -->
                <div id = card-element>
                    <!-- stripe elt inserted here -->
                </div>
                <!-- display form errors -->
                <div id="card-errors">

                </div>
            </div>
            <div>
                <button mat-button matStepperPrevious type="button">Back</button>
                <button mat-raised-button matStepperNext type="submit">Submit</button>
              </div>
        </mat-step>
        <!-- add review your order before checking out
        add topbar with psychologically effective image -->
    </mat-vertical-stepper>
</form>